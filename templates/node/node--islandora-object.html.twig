{#
/**
 * @file
 * Theme override to display a node of type 'islandora_object' (Repository Item).
 * Two-column layout with image/actions on left, metadata on right.
 */
#}

{# Helper macro for metadata fields removed, using standard fields #}

<div class="py-8" {{ attributes }}>
	<div class=" grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12">

		{# Left Column: Image and Actions #}
		<div>
			{# Main Image #}
			{# We prioritize the representative image URL extracted in preprocess, but fall back to rendered fields #}
			<div class="bg-muted mb-6 rounded-lg overflow-hidden border border-border shadow-sm">
				{% if content.field_media_image|render|trim is not empty %}
					{{ content.field_media_image }}
				{% elseif content.field_representative_image|render|trim is not empty %}
					{{ content.field_representative_image }}
				{% elseif content.field_thumbnail|render|trim is not empty %}
					{{ content.field_thumbnail }}
				{% elseif content.field_media|render|trim is not empty %}
					{{ content.field_media }}
				{% else %}
					<div class="aspect-square flex flex-col items-center justify-center text-muted-foreground bg-neutral-100 dark:bg-neutral-800 p-8">
						<svg class="w-16 h-16 mb-2 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
						<span class="text-sm">No Preview Available</span>
					</div>
				{% endif %}
			</div>
			
			{# Map Display (if coordinates exist) #}
			{% if content.field_coordinates|render|striptags|trim %}
				<div class="mb-6 rounded-lg overflow-hidden border border-border shadow-sm">
					{{ content.field_coordinates }}
				</div>
			{% endif %}

			{# Action Buttons #}
			<div class="flex flex-col gap-3">
				{# Share Button #}
				<button type="button" class="w-full py-3 px-4 bg-primary text-primary-foreground font-semibold text-sm uppercase tracking-wide flex items-center justify-center gap-2 hover:bg-primary/90 transition-colors rounded shadow-sm">
					<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>
					Share
				</button>
				
				{# Citations Button (using the logic from citation select block if possible, or just a placeholder for now) #}
				{# Since the functionality is JS driven by the block, we might not be able to replicate it purely here without the block. 
				   For now, we leave the block to be placed by the user or render the block region if we were in page template.
				   But we can add a visual placeholder or link if needed. #}
			</div>
		</div>

		{# Right Column: Metadata #}
		<div>
			{# Title context / Member of #}
			{% if content.field_member_of|render|striptags|trim %}
				<div class="mb-4 text-sm">
					{{ content.field_member_of }}
				</div>
			{% endif %}

			{# Heading #}
			{# <h1 class="text-3xl md:text-4xl font-bold text-foreground mb-2 leading-tight">
				{{ label }}
			</h1> #}

			{# Item type badge #}
			{% if content.field_resource_type|render|striptags|trim %}
				{{ content.field_resource_type }}
			{% endif %}

			<div class="h-px bg-border w-full mb-8"></div>

			{# Metadata Fields Grid #}
			<div class="space-y-6">
				{# Core Metadata #}
				{{ content.field_alt_title }}
				
				{# Contributors #}
				{{ content.field_linked_agent }}
				
				{# Dates #}
				{{ content.field_edtf_date_created }}
				{{ content.field_edtf_date_issued }}
				{{ content.field_copyright_date }}

				{# Description #}
				{{ content.field_description }}
				
				{# Note #}
				{{ content.field_note }}

				{# Physical Description #}
				{{ content.field_extent }}
				{# {{ content.field_resource_type }} #}

				{# Subjects #}
				{{ content.field_subject }}
				{{ content.field_geographic_subject }}
				{{ content.field_subjects_name }}
				
				{# Location/Rights #}
				{{ content.field_coordinates }}
				{{ content.field_rights }}
				
				{# Identifiers #}
				{{ content.field_identifier }}
				{{ content.field_repository }}
			</div>

			{# Render any remaining fields not explicitly handled, hidden #}
			<div class="hidden">
				{{ content|without(
					'field_representative_image', 'field_media_image', 'field_thumbnail', 'field_media',
					'field_member_of', 'field_model', 'field_resource_type',
					'field_rights', 'field_linked_agent', 'field_description', 'field_note',
					'field_edtf_date_created', 'field_edtf_date_issued', 'field_copyright_date', 
					'field_identifier', 'field_publisher',
					'field_repository', 'field_repository_web_site', 
					'field_geographic_location', 'field_geographic_subject', 'field_coordinates', 'field_subjects_name',
					'field_subject', 'field_extent', 'field_alt_title'
				) }}
			</div>
		</div>

	</div>
</div>

<script>
  console.group('Node Debug: {{ node.label }}');
  console.log('Content Keys:', {{ content|keys|json_encode|raw }});
  try {
    console.log('Repository Item Data:', {{ repository_item|json_encode|raw }});
  } catch(e) { console.log('Could not log repository_item'); }
  console.groupEnd();
</script>
