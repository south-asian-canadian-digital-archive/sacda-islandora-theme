{#
/**
 * @file
 * SACDA Carousel component (reusable).
 * Uses Embla Carousel with autoplay.
 * 
 * Usage:
 *   {% include '@sacda/blocks/sacda-carousel.html.twig' with {
 *     slides: carousel_slides,
 *     autoplay_speed: carousel_autoplay_speed
 *   } %}
 *
 * Variables:
 *   - slides: Array of slide objects with image_url, title, subtitle, link
 *   - autoplay_speed: Autoplay delay in milliseconds (default: 5000)
 */
#}

{% if slides|length > 0 %}
	<div
		data-carousel data-autoplay-delay="{{ autoplay_speed|default(5000) }}" class="sacda-carousel relative w-full">
		{# Viewport - the scrollable container #}
		<div
			data-carousel-viewport class="overflow-hidden">
			{# Container - holds all items with flex layout #}
			<div class="flex touch-pan-y -ms-4">
				{% for slide in slides %}
					{# Item - each slide #}
					<div class="min-w-0 shrink-0 grow-0 basis-full ps-4">
						{% if slide.link %}
							<a href="{{ slide.link }}" class="block relative aspect-video md:aspect-21/9 overflow-hidden">
							{% else %}
								<div class="relative aspect-video md:aspect-21/9 overflow-hidden">
								{% endif %}

								<img src="{{ slide.image_url }}" alt="{{ slide.title ?: 'Carousel image' }}" class="w-full h-full object-cover transition-transform duration-500 hover:scale-105" loading="{{ loop.first ? 'eager' : 'lazy' }}"/>

								{% if slide.title or slide.subtitle %}
									<div class="absolute inset-0 flex items-end bg-linear-to-t from-black/80 via-black/20 to-transparent">
										<div class="p-6 md:p-10 w-full">
											{% if slide.title %}
												<h2 class="text-2xl md:text-4xl lg:text-5xl font-bold text-white mb-2 drop-shadow-lg">{{ slide.title }}</h2>
											{% endif %}
											{% if slide.subtitle %}
												<p class="text-sm md:text-lg text-white/90 drop-shadow-md max-w-2xl">{{ slide.subtitle }}</p>
											{% endif %}
										</div>
									</div>
								{% endif %}

								{% if slide.link %}
								</a>
						{% else %}
							</div>
						{% endif %}
					</div>
				{% endfor %}
			</div>
		</div>

		{# Navigation buttons #}
		{% if slides|length > 1 %}
			<button data-carousel-prev type="button" class="absolute left-4 bottom-4 z-10 inline-flex items-center justify-center size-8 md:size-10 rounded-full border border-white/20 bg-background/80 backdrop-blur-sm text-foreground shadow-md transition-all hover:bg-background hover:scale-110 disabled:opacity-50 disabled:pointer-events-none" aria-label="Previous slide">
				<svg class="size-4" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<path d="m15 18-6-6 6-6"/>
				</svg>
			</button>

			<button data-carousel-next type="button" class="absolute right-4 bottom-4 z-10 inline-flex items-center justify-center size-8 md:size-10 rounded-full border border-white/20 bg-background/80 backdrop-blur-sm text-foreground shadow-md transition-all hover:bg-background hover:scale-110 disabled:opacity-50 disabled:pointer-events-none" aria-label="Next slide">
				<svg class="size-4" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<path d="m9 18 6-6-6-6"/>
				</svg>
			</button>

			{# Dots navigation #}
			<div data-carousel-dots class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2 z-10" aria-label="Slide indicators"></div>
		{% endif %}
	</div>
{% endif %}
