{#
/**
 * @file
 * SACDA Carousel component (reusable).
 * Uses Embla Carousel with autoplay.
 * 
 * Usage:
 *   {% include '@sacda/blocks/sacda-carousel.html.twig' with {
 *     slides: carousel_slides,
 *     autoplay_speed: carousel_autoplay_speed,
 *     slides_per_view: 3,
 *     slides_per_view_tablet: 2,
 *     slides_per_view_mobile: 1,
 *     full_height: true
 *   } %}
 *
 * Variables:
 *   - slides: Array of slide objects with image_url, title, subtitle, link
 *   - autoplay_speed: Autoplay delay in milliseconds (default: 5000)
 *   - slides_per_view: Number of slides visible on desktop (default: 1)
 *   - slides_per_view_tablet: Number of slides visible on tablet (default: slides_per_view)
 *   - slides_per_view_mobile: Number of slides visible on mobile (default: 1)
 *   - full_height: Whether carousel takes full viewport height (default: false)
 */
#}
{% import '@sacda/macros/button.twig' as btn %}

{% set height_class = full_height|default(false) ? 'h-screen' : 'md:h-[70vh] aspect-square md:aspect-auto' %}
{% set desktop_slides = slides_per_view|default(1) %}
{% set tablet_slides = slides_per_view_tablet|default(desktop_slides) %}
{% set mobile_slides = slides_per_view_mobile|default(1) %}

{% if slides|length > 0 %}
	<div
		data-carousel 
		data-autoplay-delay="{{ autoplay_speed|default(5000) }}" 
		data-slides-per-view="{{ desktop_slides }}"
		data-slides-tablet="{{ tablet_slides }}"
		data-slides-mobile="{{ mobile_slides }}"
		class="sacda-carousel relative w-full {{ height_class }}"
	>
		<div data-carousel-viewport class="overflow-hidden">
			<div class="flex touch-pan-y -ms-4">
				{% for slide in slides %}
						<div class="carousel-slide min-w-0 shrink-0 grow-0 ps-4" style="flex-basis: calc(100% / {{ desktop_slides }});"> {% if slide.link %}
							<a href="{{ slide.link }}" class="block relative {{ height_class }} overflow-hidden">
							{% else %}
								<div class="relative {{ height_class }} overflow-hidden">
								{% endif %}

								<img
								src="{{ slide.image_url }}" alt="{{ slide.title ?: 'Carousel image' }}" class="w-full h-full object-cover transition-transform duration-500 hover:scale-105" loading="{{ loop.first ? 'eager' : 'lazy' }}"/>

								{% if slide.link %}
								</a>
						{% else %}
							</div>
						{% endif %}
					</div>
				{% endfor %}
			</div>
		</div>

		{# Navigation buttons #}
		{% if slides|length > 1 %}
			{% set prev_icon = '<svg class="size-5" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>' %}
			{% set next_icon = '<svg class="size-5" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>' %}

			{# Desktop: Left/Right vertically centered, rounded #}
			<button data-carousel-prev class="hidden md:flex absolute left-4 top-1/2 -translate-y-1/2 z-10 items-center justify-center w-12 h-12 rounded-full bg-light text-foreground hover:bg-primary hover:text-primary-foreground transition-colors duration-300 cursor-pointer shadow-lg" aria-label="Previous slide">
				{{ prev_icon|raw }}
			</button>
			<button data-carousel-next class="hidden md:flex absolute right-4 top-1/2 -translate-y-1/2 z-10 items-center justify-center w-12 h-12 rounded-full bg-light text-foreground hover:bg-primary hover:text-primary-foreground transition-colors duration-300 cursor-pointer shadow-lg" aria-label="Next slide">
				{{ next_icon|raw }}
			</button>

			{# Mobile: Bottom left, squared together #}
			<div class="md:hidden absolute bottom-4 left-4 z-10 flex">
				<button data-carousel-prev class="flex items-center justify-center w-10 h-10 bg-light text-foreground hover:bg-primary hover:text-primary-foreground transition-colors duration-300 cursor-pointer" aria-label="Previous slide">
					{{ prev_icon|raw }}
				</button>
				<button data-carousel-next class="flex items-center justify-center w-10 h-10 bg-light text-foreground hover:bg-primary hover:text-primary-foreground transition-colors duration-300 cursor-pointer" aria-label="Next slide">
					{{ next_icon|raw }}
				</button>
			</div>

			{# Dots navigation - hidden on mobile #}
			<div data-carousel-dots class="hidden md:flex absolute bottom-4 left-1/2 -translate-x-1/2 gap-2 z-10" aria-label="Slide indicators"></div>
		{% endif %}
	</div>

{% endif %}
